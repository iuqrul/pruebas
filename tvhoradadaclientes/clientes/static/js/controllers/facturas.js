// Generated by CoffeeScript 1.7.1
(function() {
  var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  angular.module("facturas", []).controller("facturasController", [
    "$scope", "Restangular", "$modal", "$location", function($scope, Restangular, $modal, $location) {
      var facturas;
      facturas = Restangular.all("facturas");
      facturas.getList().then(function(facturas) {
        $scope.facturas = facturas;
        $scope.years = _.reduce(facturas, function(result, item) {
          var _ref;
          if (_ref = item.Ejercicio, __indexOf.call(result, _ref) < 0) {
            result.push(item.Ejercicio);
          }
          return result;
        }, []);
        return $scope.year = $scope.years[$scope.years.length - 1];
      });
      $scope.filtrado = function(item) {
        return item.Ejercicio === $scope.year;
      };
      $scope.detalles = function(item) {
        var modalInstance;
        return modalInstance = $modal.open({
          templateUrl: 'detalle_factura.html',
          controller: "facturaDetalleController",
          resolve: {
            factura: function() {
              return facturas.one(parseInt(item.IdFacv));
            },
            item: function() {
              return item;
            }
          }
        });
      };
      $scope.Entero = function(item) {
        return parseInt(item);
      };
      return $scope.descargar = function(factura) {
        return document.location = "/descargar/factura/" + (parseInt(factura.IdFacv));
      };
    }
  ]).controller("facturaDetalleController", [
    "factura", "item", "$scope", "$modalInstance", function(factura, item, $scope, $modalInstance) {
      $scope.Entero = function(item) {
        return parseInt(item);
      };
      $scope.factura = item;
      factura.getList("lineas").then(function(data) {
        return $scope.lineasFactura = data;
      });
      return $scope.close = function() {
        return $modalInstance.close();
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=facturas.map
