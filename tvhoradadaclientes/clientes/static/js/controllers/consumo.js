// Generated by CoffeeScript 1.7.1
(function() {
  var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  angular.module("consumo", []).controller("consumoController", [
    "$scope", "clientes", "$filter", function($scope, clientes, $filter) {
      var filtradoPorBusqueda, filtradoPorTelefono, todos;
      $scope.pageSize = 10;
      todos = 'Todos mis números';
      $scope.telefono = todos;
      clientes.one("current/consumos").getList().then(function(consumos) {
        $scope.consumos = consumos;
        $scope.setPage(1);
        return $scope.telefonos = _.reduce(consumos, function(result, item) {
          var _ref;
          if (_ref = item.TelOrigen, __indexOf.call(result, _ref) < 0) {
            result.push(item.TelOrigen);
          }
          return result;
        }, [todos]);
      });
      $scope.setPage = function(page) {
        return $scope.filter($scope.buscar, page);
      };
      filtradoPorTelefono = function(consumos, telefono) {
        if (telefono !== todos) {
          consumos = _.filter(consumos, function(item) {
            return item.TelOrigen === telefono;
          });
        }
        return consumos;
      };
      filtradoPorBusqueda = function(consumos, query) {
        if (query) {
          consumos = $filter('filter')(consumos, query);
        }
        return consumos;
      };
      $scope.filter = function(query, page) {
        var consumos_filtrados, desde;
        if (page == null) {
          page = 1;
        }
        if ($scope.consumos != null) {
          consumos_filtrados = filtradoPorTelefono(filtradoPorBusqueda($scope.consumos, query), $scope.telefono);
          desde = (page - 1) * $scope.pageSize;
          $scope.consumos_paginados = consumos_filtrados.slice(desde);
          return $scope.totalItems = consumos_filtrados.length;
        }
      };
      $scope.getTipo = function(tipo) {
        switch (tipo) {
          case 'M':
            return 'Móvil';
          case 'N':
            return 'Nacional';
          case 'I':
            return 'Internacional';
          case 'R':
            return 'Otros';
        }
      };
      $scope.$watch('buscar', function(query) {
        return $scope.filter(query);
      });
      return $scope.$watch('telefono', function() {
        return $scope.filter($scope.buscar);
      });
    }
  ]);

}).call(this);

//# sourceMappingURL=consumo.map
